
document.getElementById("input1").addEventListener("change", handleFiles, false);
document.getElementById("input2").addEventListener("change", handleFiles, false);

let p1bytes;
let p2bytes;

function handleFiles(event) {
    const file = event.target.files[0];

    if (!file) {
        console.error("No file selected.");
        return;
    }

    const playerNumber = this.getAttribute("player");
    const reader = new FileReader();

    reader.onload = (event) => {
        const saveFile = event.target.result;
        const saveFileBytes = new Uint8Array(saveFile);
        const playerBytes = saveFileBytes.slice(0x10, 0x20);
        if (playerNumber === "p1")
            p1bytes = playerBytes
        else
            p2bytes = playerBytes

        const playerNameBytes = playerBytes.slice(0, 13);
        const name = bytesToString(playerNameBytes);
        document.getElementById(playerNumber + "id").textContent = playerBytes.toHex();
        document.getElementById(playerNumber + "name").textContent = name;

        if ((p1bytes != null) && (p2bytes != null)) {
            document.getElementById("p1card").textContent = calculateCardPop(p1bytes, p2bytes, IRPARAM_CARD_POP);
            document.getElementById("p2card").textContent = calculateCardPop(p2bytes, p1bytes, IRPARAM_CARD_POP);
        }
    };

    reader.readAsArrayBuffer(file);
}

const cardData = [
    { "id": 0x1, "rarity": 0x0, "set": 0x8 },
    { "id": 0x2, "rarity": 0x0, "set": 0x8 },
    { "id": 0x3, "rarity": 0x0, "set": 0x8 },
    { "id": 0x4, "rarity": 0x0, "set": 0x8 },
    { "id": 0x5, "rarity": 0x0, "set": 0x8 },
    { "id": 0x6, "rarity": 0x0, "set": 0x8 },
    { "id": 0x7, "rarity": 0x1, "set": 0x1 },
    { "id": 0x8, "rarity": 0x0, "set": 0x5 },
    { "id": 0x9, "rarity": 0x0, "set": 0x5 },
    { "id": 0xa, "rarity": 0x2, "set": 0x5 },
    { "id": 0xb, "rarity": 0x1, "set": 0x6 },
    { "id": 0xc, "rarity": 0x0, "set": 0x0 },
    { "id": 0xd, "rarity": 0x0, "set": 0x6 },
    { "id": 0xe, "rarity": 0x1, "set": 0x4 },
    { "id": 0xf, "rarity": 0x1, "set": 0x3 },
    { "id": 0x10, "rarity": 0x1, "set": 0x0 },
    { "id": 0x11, "rarity": 0x1, "set": 0x6 },
    { "id": 0x12, "rarity": 0x2, "set": 0x7 },
    { "id": 0x13, "rarity": 0x2, "set": 0x1 },
    { "id": 0x14, "rarity": 0x2, "set": 0x7 },
    { "id": 0x15, "rarity": 0x2, "set": 0x6 },
    { "id": 0x16, "rarity": 0x0, "set": 0x1 },
    { "id": 0x17, "rarity": 0x1, "set": 0x3 },
    { "id": 0x18, "rarity": 0x1, "set": 0x1 },
    { "id": 0x19, "rarity": 0x1, "set": 0x1 },
    { "id": 0x1a, "rarity": 0x0, "set": 0x0 },
    { "id": 0x1b, "rarity": 0x0, "set": 0x3 },
    { "id": 0x1c, "rarity": 0x1, "set": 0x3 },
    { "id": 0x1d, "rarity": 0x1, "set": 0x0 },
    { "id": 0x1e, "rarity": 0x2, "set": 0x0 },
    { "id": 0x1f, "rarity": 0x0, "set": 0x2 },
    { "id": 0x20, "rarity": 0x0, "set": 0x5 },
    { "id": 0x21, "rarity": 0x1, "set": 0x3 },
    { "id": 0x22, "rarity": 0x2, "set": 0x2 },
    { "id": 0x23, "rarity": 0x2, "set": 0x5 },
    { "id": 0x24, "rarity": 0x0, "set": 0x3 },
    { "id": 0x25, "rarity": 0x0, "set": 0x1 },
    { "id": 0x26, "rarity": 0x1, "set": 0x3 },
    { "id": 0x27, "rarity": 0x1, "set": 0x1 },
    { "id": 0x28, "rarity": 0x2, "set": 0x2 },
    { "id": 0x29, "rarity": 0x0, "set": 0x0 },
    { "id": 0x2a, "rarity": 0x0, "set": 0x3 },
    { "id": 0x2b, "rarity": 0x1, "set": 0x3 },
    { "id": 0x2c, "rarity": 0x1, "set": 0x0 },
    { "id": 0x2d, "rarity": 0x2, "set": 0x1 },
    { "id": 0x2e, "rarity": 0x0, "set": 0x6 },
    { "id": 0x2f, "rarity": 0x0, "set": 0x2 },
    { "id": 0x30, "rarity": 0x0, "set": 0x4 },
    { "id": 0x31, "rarity": 0x1, "set": 0x2 },
    { "id": 0x32, "rarity": 0x1, "set": 0x4 },
    { "id": 0x33, "rarity": 0x2, "set": 0x6 },
    { "id": 0x34, "rarity": 0x0, "set": 0x2 },
    { "id": 0x35, "rarity": 0x0, "set": 0x6 },
    { "id": 0x36, "rarity": 0x1, "set": 0x2 },
    { "id": 0x37, "rarity": 0x1, "set": 0x6 },
    { "id": 0x38, "rarity": 0x2, "set": 0x2 },
    { "id": 0x39, "rarity": 0x2, "set": 0x6 },
    { "id": 0x3a, "rarity": 0x0, "set": 0x3 },
    { "id": 0x3b, "rarity": 0x0, "set": 0x1 },
    { "id": 0x3c, "rarity": 0x1, "set": 0x3 },
    { "id": 0x3d, "rarity": 0x1, "set": 0x1 },
    { "id": 0x3e, "rarity": 0x0, "set": 0x3 },
    { "id": 0x3f, "rarity": 0x0, "set": 0x0 },
    { "id": 0x40, "rarity": 0x0, "set": 0x3 },
    { "id": 0x41, "rarity": 0x2, "set": 0x0 },
    { "id": 0x42, "rarity": 0x0, "set": 0x4 },
    { "id": 0x43, "rarity": 0x0, "set": 0x2 },
    { "id": 0x44, "rarity": 0x1, "set": 0x4 },
    { "id": 0x45, "rarity": 0x1, "set": 0x2 },
    { "id": 0x46, "rarity": 0x2, "set": 0x2 },
    { "id": 0x47, "rarity": 0x0, "set": 0x5 },
    { "id": 0x48, "rarity": 0x0, "set": 0x2 },
    { "id": 0x49, "rarity": 0x2, "set": 0x2 },
    { "id": 0x4a, "rarity": 0x1, "set": 0x5 },
    { "id": 0x4b, "rarity": 0x0, "set": 0x1 },
    { "id": 0x4c, "rarity": 0x1, "set": 0x1 },
    { "id": 0x4d, "rarity": 0x0, "set": 0x6 },
    { "id": 0x4e, "rarity": 0x0, "set": 0x3 },
    { "id": 0x4f, "rarity": 0x0, "set": 0x2 },
    { "id": 0x50, "rarity": 0x2, "set": 0x4 },
    { "id": 0x51, "rarity": 0x1, "set": 0x2 },
    { "id": 0x52, "rarity": 0x2, "set": 0x6 },
    { "id": 0x53, "rarity": 0x1, "set": 0x0 },
    { "id": 0x54, "rarity": 0x1, "set": 0x3 },
    { "id": 0x55, "rarity": 0x2, "set": 0x1 },
    { "id": 0x56, "rarity": 0x2, "set": 0x5 },
    { "id": 0x57, "rarity": 0x1, "set": 0x6 },
    { "id": 0x58, "rarity": 0x2, "set": 0x2 },
    { "id": 0x59, "rarity": 0x0, "set": 0x5 },
    { "id": 0x5a, "rarity": 0x0, "set": 0x0 },
    { "id": 0x5b, "rarity": 0x1, "set": 0x3 },
    { "id": 0x5c, "rarity": 0x1, "set": 0x0 },
    { "id": 0x5d, "rarity": 0x1, "set": 0x5 },
    { "id": 0x5e, "rarity": 0x2, "set": 0x0 },
    { "id": 0x5f, "rarity": 0x2, "set": 0x7 },
    { "id": 0x60, "rarity": 0x2, "set": 0x5 },
    { "id": 0x61, "rarity": 0x0, "set": 0x0 },
    { "id": 0x62, "rarity": 0x0, "set": 0x3 },
    { "id": 0x63, "rarity": 0x2, "set": 0x0 },
    { "id": 0x64, "rarity": 0x2, "set": 0x3 },
    { "id": 0x65, "rarity": 0x2, "set": 0x6 },
    { "id": 0x66, "rarity": 0x1, "set": 0x0 },
    { "id": 0x67, "rarity": 0x0, "set": 0x6 },
    { "id": 0x68, "rarity": 0x1, "set": 0x3 },
    { "id": 0x69, "rarity": 0xff, "set": 0x7 },
    { "id": 0x6a, "rarity": 0x2, "set": 0x0 },
    { "id": 0x6b, "rarity": 0x2, "set": 0x1 },
    { "id": 0x6c, "rarity": 0x0, "set": 0x4 },
    { "id": 0x6d, "rarity": 0x0, "set": 0x0 },
    { "id": 0x6e, "rarity": 0x0, "set": 0x5 },
    { "id": 0x6f, "rarity": 0x1, "set": 0x4 },
    { "id": 0x70, "rarity": 0x1, "set": 0x0 },
    { "id": 0x71, "rarity": 0x0, "set": 0x5 },
    { "id": 0x72, "rarity": 0x1, "set": 0x1 },
    { "id": 0x73, "rarity": 0x1, "set": 0x2 },
    { "id": 0x74, "rarity": 0x0, "set": 0x4 },
    { "id": 0x75, "rarity": 0x1, "set": 0x5 },
    { "id": 0x76, "rarity": 0x1, "set": 0x3 },
    { "id": 0x77, "rarity": 0x2, "set": 0x1 },
    { "id": 0x78, "rarity": 0x1, "set": 0x5 },
    { "id": 0x79, "rarity": 0x2, "set": 0x1 },
    { "id": 0x7a, "rarity": 0x2, "set": 0x6 },
    { "id": 0x7b, "rarity": 0x2, "set": 0x7 },
    { "id": 0x7c, "rarity": 0x0, "set": 0x2 },
    { "id": 0x7d, "rarity": 0x0, "set": 0x1 },
    { "id": 0x7e, "rarity": 0x1, "set": 0x4 },
    { "id": 0x7f, "rarity": 0x0, "set": 0x5 },
    { "id": 0x80, "rarity": 0x1, "set": 0x2 },
    { "id": 0x81, "rarity": 0x1, "set": 0x1 },
    { "id": 0x82, "rarity": 0x1, "set": 0x5 },
    { "id": 0x83, "rarity": 0x2, "set": 0x1 },
    { "id": 0x84, "rarity": 0x2, "set": 0x7 },
    { "id": 0x85, "rarity": 0x2, "set": 0x5 },
    { "id": 0x86, "rarity": 0x0, "set": 0x2 },
    { "id": 0x87, "rarity": 0x0, "set": 0x6 },
    { "id": 0x88, "rarity": 0x1, "set": 0x4 },
    { "id": 0x89, "rarity": 0x2, "set": 0x2 },
    { "id": 0x8a, "rarity": 0x1, "set": 0x6 },
    { "id": 0x8b, "rarity": 0x0, "set": 0x2 },
    { "id": 0x8c, "rarity": 0x0, "set": 0x4 },
    { "id": 0x8d, "rarity": 0x1, "set": 0x4 },
    { "id": 0x8e, "rarity": 0x1, "set": 0x2 },
    { "id": 0x8f, "rarity": 0x2, "set": 0x2 },
    { "id": 0x90, "rarity": 0x2, "set": 0x4 },
    { "id": 0x91, "rarity": 0x0, "set": 0x1 },
    { "id": 0x92, "rarity": 0x1, "set": 0x1 },
    { "id": 0x93, "rarity": 0x0, "set": 0x4 },
    { "id": 0x94, "rarity": 0x0, "set": 0x0 },
    { "id": 0x95, "rarity": 0x1, "set": 0x4 },
    { "id": 0x96, "rarity": 0x2, "set": 0x0 },
    { "id": 0x97, "rarity": 0x0, "set": 0x1 },
    { "id": 0x98, "rarity": 0x0, "set": 0x3 },
    { "id": 0x99, "rarity": 0x1, "set": 0x1 },
    { "id": 0x9a, "rarity": 0x0, "set": 0x3 },
    { "id": 0x9b, "rarity": 0x0, "set": 0x0 },
    { "id": 0x9c, "rarity": 0x1, "set": 0x0 },
    { "id": 0x9d, "rarity": 0x2, "set": 0x3 },
    { "id": 0x9e, "rarity": 0x0, "set": 0x2 },
    { "id": 0x9f, "rarity": 0x0, "set": 0x4 },
    { "id": 0xa0, "rarity": 0x1, "set": 0x2 },
    { "id": 0xa1, "rarity": 0x2, "set": 0x4 },
    { "id": 0xa2, "rarity": 0x0, "set": 0x1 },
    { "id": 0xa3, "rarity": 0x1, "set": 0x1 },
    { "id": 0xa4, "rarity": 0x0, "set": 0x0 },
    { "id": 0xa5, "rarity": 0x0, "set": 0x3 },
    { "id": 0xa6, "rarity": 0x1, "set": 0x0 },
    { "id": 0xa7, "rarity": 0x1, "set": 0x6 },
    { "id": 0xa8, "rarity": 0x0, "set": 0x5 },
    { "id": 0xa9, "rarity": 0x1, "set": 0x0 },
    { "id": 0xaa, "rarity": 0xff, "set": 0x7 },
    { "id": 0xab, "rarity": 0x2, "set": 0x0 },
    { "id": 0xac, "rarity": 0x2, "set": 0x5 },
    { "id": 0xad, "rarity": 0x2, "set": 0x1 },
    { "id": 0xae, "rarity": 0x2, "set": 0x4 },
    { "id": 0xaf, "rarity": 0x1, "set": 0x3 },
    { "id": 0xb0, "rarity": 0x2, "set": 0x1 },
    { "id": 0xb1, "rarity": 0x1, "set": 0x5 },
    { "id": 0xb2, "rarity": 0x0, "set": 0x2 },
    { "id": 0xb3, "rarity": 0x1, "set": 0x5 },
    { "id": 0xb4, "rarity": 0x1, "set": 0x4 },
    { "id": 0xb5, "rarity": 0x1, "set": 0x2 },
    { "id": 0xb6, "rarity": 0x2, "set": 0x7 },
    { "id": 0xb7, "rarity": 0x2, "set": 0x6 },
    { "id": 0xb8, "rarity": 0x2, "set": 0x2 },
    { "id": 0xb9, "rarity": 0x2, "set": 0x7 },
    { "id": 0xba, "rarity": 0xff, "set": 0x7 },
    { "id": 0xbb, "rarity": 0x1, "set": 0x4 },
    { "id": 0xbc, "rarity": 0x0, "set": 0x0 },
    { "id": 0xbd, "rarity": 0x2, "set": 0x7 },
    { "id": 0xbe, "rarity": 0x0, "set": 0x2 },
    { "id": 0xbf, "rarity": 0xff, "set": 0x7 },
    { "id": 0xc0, "rarity": 0xff, "set": 0x7 },
    { "id": 0xc1, "rarity": 0xff, "set": 0x7 },
    { "id": 0xc2, "rarity": 0xff, "set": 0x7 },
    { "id": 0xc3, "rarity": 0xff, "set": 0x7 },
    { "id": 0xc4, "rarity": 0xff, "set": 0x7 },
    { "id": 0xc5, "rarity": 0x2, "set": 0x4 },
    { "id": 0xc6, "rarity": 0x2, "set": 0x0 },
    { "id": 0xc7, "rarity": 0x2, "set": 0x3 },
    { "id": 0xc8, "rarity": 0x2, "set": 0x2 },
    { "id": 0xc9, "rarity": 0x2, "set": 0x6 },
    { "id": 0xca, "rarity": 0x0, "set": 0x5 },
    { "id": 0xcb, "rarity": 0x0, "set": 0x3 },
    { "id": 0xcc, "rarity": 0x0, "set": 0x1 },
    { "id": 0xcd, "rarity": 0x0, "set": 0x4 },
    { "id": 0xce, "rarity": 0x2, "set": 0x3 },
    { "id": 0xcf, "rarity": 0x2, "set": 0x1 },
    { "id": 0xd0, "rarity": 0x2, "set": 0x4 },
    { "id": 0xd1, "rarity": 0x2, "set": 0x5 },
    { "id": 0xd2, "rarity": 0x0, "set": 0x4 },
    { "id": 0xd3, "rarity": 0x0, "set": 0x2 },
    { "id": 0xd4, "rarity": 0x0, "set": 0x5 },
    { "id": 0xd5, "rarity": 0x2, "set": 0x2 },
    { "id": 0xd6, "rarity": 0x2, "set": 0x4 },
    { "id": 0xd7, "rarity": 0x1, "set": 0x5 },
    { "id": 0xd8, "rarity": 0xff, "set": 0x7 },
    { "id": 0xd9, "rarity": 0x2, "set": 0x0 },
    { "id": 0xda, "rarity": 0x2, "set": 0x1 },
    { "id": 0xdb, "rarity": 0x1, "set": 0x3 },
    { "id": 0xdc, "rarity": 0x2, "set": 0x1 },
    { "id": 0xdd, "rarity": 0x1, "set": 0x5 },
    { "id": 0xde, "rarity": 0x2, "set": 0x6 },
    { "id": 0xdf, "rarity": 0x2, "set": 0x4 },
    { "id": 0xe0, "rarity": 0x2, "set": 0x0 },
    { "id": 0xe1, "rarity": 0x2, "set": 0x7 },
    { "id": 0xe2, "rarity": 0x0, "set": 0x1 },
    { "id": 0xe3, "rarity": 0x0, "set": 0x4 },
    { "id": 0xe4, "rarity": 0x1, "set": 0x1 },
    { "id": 0xe5, "rarity": 0x1, "set": 0x4 },
    { "id": 0xe6, "rarity": 0x0, "set": 0x0 },
    { "id": 0xe7, "rarity": 0x0, "set": 0x5 },
    { "id": 0xe8, "rarity": 0xff, "set": 0x7 },
    { "id": 0xe9, "rarity": 0x2, "set": 0x0 },
    { "id": 0xea, "rarity": 0xff, "set": 0x7 },
    { "id": 0xeb, "rarity": 0x2, "set": 0x5 },
    { "id": 0xec, "rarity": 0x0, "set": 0x2 },
    { "id": 0xed, "rarity": 0xff, "set": 0x7 },
    { "id": 0xee, "rarity": 0x0, "set": 0x5 },
    { "id": 0xef, "rarity": 0x1, "set": 0x2 },
    { "id": 0xf0, "rarity": 0x1, "set": 0x5 },
    { "id": 0xf1, "rarity": 0x0, "set": 0x4 },
    { "id": 0xf2, "rarity": 0x0, "set": 0x0 },
    { "id": 0xf3, "rarity": 0x0, "set": 0x5 },
    { "id": 0xf4, "rarity": 0x1, "set": 0x2 },
    { "id": 0xf5, "rarity": 0x1, "set": 0x4 },
    { "id": 0xf6, "rarity": 0x1, "set": 0x0 },
    { "id": 0xf7, "rarity": 0x1, "set": 0x5 },
    { "id": 0xf8, "rarity": 0x2, "set": 0x7 },
    { "id": 0xf9, "rarity": 0x2, "set": 0x0 },
    { "id": 0xfa, "rarity": 0x2, "set": 0x5 },
    { "id": 0xfb, "rarity": 0x0, "set": 0x1 },
    { "id": 0xfc, "rarity": 0x0, "set": 0x4 },
    { "id": 0xfd, "rarity": 0x1, "set": 0x3 },
    { "id": 0xfe, "rarity": 0x1, "set": 0x4 },
    { "id": 0xff, "rarity": 0x1, "set": 0x1 },
    { "id": 0x100, "rarity": 0x1, "set": 0x2 },
    { "id": 0x101, "rarity": 0x2, "set": 0x7 },
    { "id": 0x102, "rarity": 0x0, "set": 0x0 },
    { "id": 0x103, "rarity": 0x1, "set": 0x6 },
    { "id": 0x104, "rarity": 0x0, "set": 0x4 },
    { "id": 0x105, "rarity": 0x0, "set": 0x1 },
    { "id": 0x106, "rarity": 0x1, "set": 0x4 },
    { "id": 0x107, "rarity": 0x1, "set": 0x1 },
    { "id": 0x108, "rarity": 0x1, "set": 0x6 },
    { "id": 0x109, "rarity": 0x2, "set": 0x1 },
    { "id": 0x10a, "rarity": 0x2, "set": 0x4 },
    { "id": 0x10b, "rarity": 0x2, "set": 0x4 },
    { "id": 0x10c, "rarity": 0x2, "set": 0x0 },
    { "id": 0x10d, "rarity": 0x0, "set": 0x1 },
    { "id": 0x10e, "rarity": 0x2, "set": 0x3 },
    { "id": 0x10f, "rarity": 0x1, "set": 0x1 },
    { "id": 0x110, "rarity": 0x0, "set": 0x2 },
    { "id": 0x111, "rarity": 0x1, "set": 0x5 },
    { "id": 0x112, "rarity": 0x2, "set": 0x3 },
    { "id": 0x113, "rarity": 0x2, "set": 0x5 },
    { "id": 0x114, "rarity": 0x1, "set": 0x2 },
    { "id": 0x115, "rarity": 0x0, "set": 0x4 },
    { "id": 0x116, "rarity": 0x0, "set": 0x1 },
    { "id": 0x117, "rarity": 0x0, "set": 0x5 },
    { "id": 0x118, "rarity": 0x1, "set": 0x1 },
    { "id": 0x119, "rarity": 0x2, "set": 0x4 },
    { "id": 0x11a, "rarity": 0x1, "set": 0x5 },
    { "id": 0x11b, "rarity": 0x2, "set": 0x2 },
    { "id": 0x11c, "rarity": 0x2, "set": 0x7 },
    { "id": 0x11d, "rarity": 0x2, "set": 0x5 },
    { "id": 0x11e, "rarity": 0xff, "set": 0x7 },
    { "id": 0x11f, "rarity": 0x0, "set": 0x6 },
    { "id": 0x120, "rarity": 0x0, "set": 0x2 },
    { "id": 0x121, "rarity": 0x1, "set": 0x2 },
    { "id": 0x122, "rarity": 0x0, "set": 0x4 },
    { "id": 0x123, "rarity": 0x2, "set": 0x6 },
    { "id": 0x124, "rarity": 0x0, "set": 0x0 },
    { "id": 0x125, "rarity": 0x0, "set": 0x2 },
    { "id": 0x126, "rarity": 0x1, "set": 0x3 },
    { "id": 0x127, "rarity": 0x2, "set": 0x3 },
    { "id": 0x128, "rarity": 0x1, "set": 0x0 },
    { "id": 0x129, "rarity": 0x2, "set": 0x4 },
    { "id": 0x12a, "rarity": 0x1, "set": 0x2 },
    { "id": 0x12b, "rarity": 0x1, "set": 0x6 },
    { "id": 0x12c, "rarity": 0x2, "set": 0x2 },
    { "id": 0x12d, "rarity": 0x2, "set": 0x7 },
    { "id": 0x12e, "rarity": 0x2, "set": 0x6 },
    { "id": 0x12f, "rarity": 0x0, "set": 0x6 },
    { "id": 0x130, "rarity": 0x0, "set": 0x0 },
    { "id": 0x131, "rarity": 0x1, "set": 0x2 },
    { "id": 0x132, "rarity": 0x2, "set": 0x0 },
    { "id": 0x133, "rarity": 0x2, "set": 0x6 },
    { "id": 0x134, "rarity": 0x2, "set": 0x5 },
    { "id": 0x135, "rarity": 0x2, "set": 0x3 },
    { "id": 0x136, "rarity": 0x2, "set": 0x5 },
    { "id": 0x137, "rarity": 0x1, "set": 0x2 },
    { "id": 0x138, "rarity": 0x1, "set": 0x0 },
    { "id": 0x139, "rarity": 0x2, "set": 0x7 },
    { "id": 0x13a, "rarity": 0x2, "set": 0x5 },
    { "id": 0x13b, "rarity": 0x2, "set": 0x1 },
    { "id": 0x13c, "rarity": 0xff, "set": 0x7 },
    { "id": 0x13d, "rarity": 0xff, "set": 0x7 },
    { "id": 0x13e, "rarity": 0x2, "set": 0x3 },
    { "id": 0x13f, "rarity": 0x2, "set": 0x7 },
    { "id": 0x140, "rarity": 0xff, "set": 0x7 },
    { "id": 0x141, "rarity": 0x2, "set": 0x7 },
    { "id": 0x142, "rarity": 0x2, "set": 0x3 },
    { "id": 0x143, "rarity": 0x0, "set": 0x3 },
    { "id": 0x144, "rarity": 0x0, "set": 0x4 },
    { "id": 0x145, "rarity": 0x1, "set": 0x4 },
    { "id": 0x146, "rarity": 0x1, "set": 0x3 },
    { "id": 0x147, "rarity": 0x2, "set": 0x3 },
    { "id": 0x148, "rarity": 0x2, "set": 0x4 },
    { "id": 0x149, "rarity": 0x0, "set": 0x0 },
    { "id": 0x14a, "rarity": 0x0, "set": 0x5 },
    { "id": 0x14b, "rarity": 0x0, "set": 0x4 },
    { "id": 0x14c, "rarity": 0x1, "set": 0x0 },
    { "id": 0x14d, "rarity": 0x0, "set": 0x5 },
    { "id": 0x14e, "rarity": 0x0, "set": 0x1 },
    { "id": 0x14f, "rarity": 0x0, "set": 0x3 },
    { "id": 0x150, "rarity": 0x0, "set": 0x4 },
    { "id": 0x151, "rarity": 0x1, "set": 0x4 },
    { "id": 0x152, "rarity": 0x1, "set": 0x3 },
    { "id": 0x153, "rarity": 0x1, "set": 0x6 },
    { "id": 0x154, "rarity": 0x2, "set": 0x3 },
    { "id": 0x155, "rarity": 0x1, "set": 0x1 },
    { "id": 0x156, "rarity": 0x2, "set": 0x2 },
    { "id": 0x157, "rarity": 0x2, "set": 0x6 },
    { "id": 0x158, "rarity": 0xff, "set": 0x7 },
    { "id": 0x159, "rarity": 0x0, "set": 0x3 },
    { "id": 0x15a, "rarity": 0x0, "set": 0x1 },
    { "id": 0x15b, "rarity": 0x2, "set": 0x1 },
    { "id": 0x15c, "rarity": 0x2, "set": 0x4 },
    { "id": 0x15d, "rarity": 0x0, "set": 0x6 },
    { "id": 0x15e, "rarity": 0x1, "set": 0x5 },
    { "id": 0x15f, "rarity": 0xff, "set": 0x7 },
    { "id": 0x160, "rarity": 0x0, "set": 0x2 },
    { "id": 0x161, "rarity": 0x0, "set": 0x0 },
    { "id": 0x162, "rarity": 0x1, "set": 0x2 },
    { "id": 0x163, "rarity": 0x0, "set": 0x6 },
    { "id": 0x164, "rarity": 0x0, "set": 0x7 },
    { "id": 0x165, "rarity": 0x1, "set": 0x1 },
    { "id": 0x166, "rarity": 0xff, "set": 0x7 },
    { "id": 0x167, "rarity": 0x0, "set": 0x4 },
    { "id": 0x168, "rarity": 0x0, "set": 0x3 },
    { "id": 0x169, "rarity": 0x1, "set": 0x4 },
    { "id": 0x16a, "rarity": 0x1, "set": 0x3 },
    { "id": 0x16b, "rarity": 0x1, "set": 0x2 },
    { "id": 0x16c, "rarity": 0x1, "set": 0x6 },
    { "id": 0x16d, "rarity": 0x1, "set": 0x6 },
    { "id": 0x16e, "rarity": 0x2, "set": 0x0 },
    { "id": 0x16f, "rarity": 0x1, "set": 0x6 },
    { "id": 0x170, "rarity": 0xff, "set": 0x7 },
    { "id": 0x171, "rarity": 0x2, "set": 0x1 },
    { "id": 0x172, "rarity": 0x1, "set": 0x5 },
    { "id": 0x173, "rarity": 0x0, "set": 0x2 },
    { "id": 0x174, "rarity": 0x2, "set": 0x3 },
    { "id": 0x175, "rarity": 0x1, "set": 0x3 },
    { "id": 0x176, "rarity": 0x0, "set": 0x5 },
    { "id": 0x177, "rarity": 0x0, "set": 0x0 },
    { "id": 0x178, "rarity": 0x1, "set": 0x0 },
    { "id": 0x179, "rarity": 0x1, "set": 0x2 },
    { "id": 0x17a, "rarity": 0x0, "set": 0x6 },
    { "id": 0x17b, "rarity": 0xff, "set": 0x7 },
    { "id": 0x17c, "rarity": 0x2, "set": 0x0 },
    { "id": 0x17d, "rarity": 0x2, "set": 0x4 },
    { "id": 0x17e, "rarity": 0xff, "set": 0x7 },
    { "id": 0x17f, "rarity": 0x0, "set": 0x1 },
    { "id": 0x180, "rarity": 0x0, "set": 0x6 },
    { "id": 0x181, "rarity": 0x2, "set": 0x1 },
    { "id": 0x182, "rarity": 0x1, "set": 0x6 },
    { "id": 0x183, "rarity": 0x2, "set": 0x7 },
    { "id": 0x184, "rarity": 0xff, "set": 0x7 },
    { "id": 0x185, "rarity": 0x2, "set": 0x1 },
    { "id": 0x186, "rarity": 0x2, "set": 0x6 },
    { "id": 0x187, "rarity": 0xff, "set": 0x7 },
    { "id": 0x188, "rarity": 0x2, "set": 0x7 },
    { "id": 0x189, "rarity": 0x1, "set": 0x0 },
    { "id": 0x18a, "rarity": 0xff, "set": 0x7 },
    { "id": 0x18b, "rarity": 0x0, "set": 0x1 },
    { "id": 0x18c, "rarity": 0x1, "set": 0x0 },
    { "id": 0x18d, "rarity": 0x0, "set": 0x0 },
    { "id": 0x18e, "rarity": 0x1, "set": 0x0 },
    { "id": 0x18f, "rarity": 0x1, "set": 0x3 },
    { "id": 0x190, "rarity": 0x0, "set": 0x0 },
    { "id": 0x191, "rarity": 0x0, "set": 0x3 },
    { "id": 0x192, "rarity": 0x1, "set": 0x1 },
    { "id": 0x193, "rarity": 0x1, "set": 0x5 },
    { "id": 0x194, "rarity": 0x0, "set": 0x6 },
    { "id": 0x195, "rarity": 0x2, "set": 0x5 },
    { "id": 0x196, "rarity": 0x2, "set": 0x2 },
    { "id": 0x197, "rarity": 0x1, "set": 0x6 },
    { "id": 0x198, "rarity": 0xff, "set": 0x7 },
    { "id": 0x199, "rarity": 0x2, "set": 0x2 },
    { "id": 0x19a, "rarity": 0x2, "set": 0x3 },
    { "id": 0x19b, "rarity": 0x1, "set": 0x1 },
    { "id": 0x19c, "rarity": 0x0, "set": 0x1 },
    { "id": 0x19d, "rarity": 0x0, "set": 0x2 },
    { "id": 0x19e, "rarity": 0x1, "set": 0x0 },
    { "id": 0x19f, "rarity": 0x1, "set": 0x6 },
    { "id": 0x1a0, "rarity": 0x2, "set": 0x3 },
    { "id": 0x1a1, "rarity": 0x0, "set": 0x6 },
    { "id": 0x1a2, "rarity": 0xff, "set": 0x7 },
    { "id": 0x1a3, "rarity": 0x2, "set": 0x2 },
    { "id": 0x1a4, "rarity": 0x0, "set": 0x6 },
    { "id": 0x1a5, "rarity": 0x2, "set": 0x2 },
    { "id": 0x1a6, "rarity": 0x1, "set": 0x4 },
    { "id": 0x1a7, "rarity": 0x1, "set": 0x1 },
    { "id": 0x1a8, "rarity": 0x0, "set": 0x0 },
    { "id": 0x1a9, "rarity": 0x2, "set": 0x0 },
    { "id": 0x1aa, "rarity": 0x0, "set": 0x1 },
    { "id": 0x1ab, "rarity": 0x2, "set": 0x4 },
    { "id": 0x1ac, "rarity": 0x1, "set": 0x0 },
    { "id": 0x1ad, "rarity": 0x1, "set": 0x1 },
    { "id": 0x1ae, "rarity": 0x2, "set": 0x1 },
    { "id": 0x1af, "rarity": 0x1, "set": 0x4 },
    { "id": 0x1b0, "rarity": 0x1, "set": 0x5 },
    { "id": 0x1b1, "rarity": 0x0, "set": 0x6 },
    { "id": 0x1b2, "rarity": 0x0, "set": 0x0 },
    { "id": 0x1b3, "rarity": 0x0, "set": 0x6 },
    { "id": 0x1b4, "rarity": 0x0, "set": 0x7 },
    { "id": 0x1b5, "rarity": 0x2, "set": 0x4 },
    { "id": 0x1b6, "rarity": 0x2, "set": 0x3 },
    { "id": 0x1b7, "rarity": 0x1, "set": 0x4 },
    { "id": 0x1b8, "rarity": 0x0, "set": 0x2 },
    { "id": 0x1b9, "rarity": 0x0, "set": 0x6 },
    { "id": 0x1ba, "rarity": 0x0, "set": 0x3 },
    { "id": 0x1bb, "rarity": 0x2, "set": 0x6 },
    { "id": 0x1bc, "rarity": 0x3, "set": 0x7 },
    { "id": 0x1bd, "rarity": 0x2, "set": 0x6 },
];

const cardDataTypes = [
    "PKMN_FIRE",
    "PKMN_GRASS",
    "PKMN_LIGHTNING",
    "PKMN_WATER",
    "PKMN_FIGHTING",
    "PKMN_PSYCHIC",
    "PKMN_COLORLESS",
    "PKMN_RAINBOW",
    "ENERGY_FIRE",
    "ENERGY_GRASS",
    "ENERGY_LIGHTNING",
    "ENERGY_WATER",
    "ENERGY_FIGHTING",
    "ENERGY_PSYCHIC",
    "ENERGY_COLORLESS",
    "ENERGY_SPECIAL",
    "TRAINER",
    "TRAINER_UNUSED",
];

const cardDataRarity = new Map([
    [0x00, "CIRCLE"],
    [0x01, "DIAMOND"],
    [0x02, "STAR"],
    [0x03, "STAR_BORDER"],
    [0xff, "PROMOSTAR"],
]);

const cardDataSet = [
    "BEGINNING_POKEMON",
    "LEGENDARY_POWER",
    "ISLAND_OF_FOSSIL",
    "PSYCHIC_BATTLE",
    "SKY_FLYING_POKEMON",
    "WE_ARE_TEAM_ROCKET",
    "TEAM_ROCKETS_AMBITION",
    "PROMOTIONAL",
    "BASIC_ENERGY_CARDS",
];

const cardNames = [
    "NULL",
    "GRASS_ENERGY",
    "FIRE_ENERGY",
    "WATER_ENERGY",
    "LIGHTNING_ENERGY",
    "FIGHTING_ENERGY",
    "PSYCHIC_ENERGY",
    "DOUBLE_COLORLESS_ENERGY",
    "POTION_ENERGY",
    "FULLHEAL_ENERGY",
    "RAINBOW_ENERGY",
    "RECYCLE_ENERGY",
    "BULBASAUR_LV12",
    "BULBASAUR_LV13",
    "BULBASAUR_LV15",
    "IVYSAUR_LV20",
    "IVYSAUR_LV26",
    "DARK_IVYSAUR",
    "VENUSAUR_LV64",
    "VENUSAUR_LV67",
    "VENUSAUR_ALT_LV67",
    "DARK_VENUSAUR",
    "CATERPIE",
    "METAPOD_LV20",
    "METAPOD_LV21",
    "BUTTERFREE",
    "WEEDLE_LV12",
    "WEEDLE_LV15",
    "KAKUNA_LV20",
    "KAKUNA_LV23",
    "BEEDRILL",
    "EKANS_LV10",
    "EKANS_LV15",
    "ARBOK_LV27",
    "ARBOK_LV30",
    "DARK_ARBOK",
    "NIDORANF_LV12",
    "NIDORANF_LV13",
    "NIDORINA_LV22",
    "NIDORINA_LV24",
    "NIDOQUEEN",
    "NIDORANM_LV20",
    "NIDORANM_LV22",
    "NIDORINO_LV23",
    "NIDORINO_LV25",
    "NIDOKING",
    "ZUBAT_LV9",
    "ZUBAT_LV10",
    "ZUBAT_LV12",
    "GOLBAT_LV25",
    "GOLBAT_LV29",
    "DARK_GOLBAT",
    "ODDISH_LV8",
    "ODDISH_LV21",
    "GLOOM",
    "DARK_GLOOM",
    "VILEPLUME",
    "DARK_VILEPLUME",
    "PARAS_LV8",
    "PARAS_LV15",
    "PARASECT_LV28",
    "PARASECT_LV29",
    "VENONAT_LV12",
    "VENONAT_LV15",
    "VENOMOTH_LV22",
    "VENOMOTH_LV28",
    "BELLSPROUT_LV10",
    "BELLSPROUT_LV11",
    "WEEPINBELL_LV23",
    "WEEPINBELL_LV28",
    "VICTREEBEL",
    "GRIMER_LV10",
    "GRIMER_LV17",
    "MUK",
    "DARK_MUK",
    "EXEGGCUTE",
    "EXEGGUTOR",
    "KOFFING_LV12",
    "KOFFING_LV13",
    "KOFFING_LV14",
    "WEEZING_LV26",
    "WEEZING_LV27",
    "DARK_WEEZING",
    "TANGELA_LV8",
    "TANGELA_LV12",
    "SCYTHER_LV23",
    "SCYTHER_LV25",
    "PINSIR_LV15",
    "PINSIR_LV24",
    "CHARMANDER_LV9",
    "CHARMANDER_LV10",
    "CHARMANDER_LV12",
    "CHARMELEON",
    "DARK_CHARMELEON",
    "CHARIZARD_LV76",
    "CHARIZARD_ALT_LV76",
    "DARK_CHARIZARD",
    "VULPIX_LV11",
    "VULPIX_LV13",
    "NINETALES_LV32",
    "NINETALES_LV35",
    "DARK_NINETALES",
    "GROWLITHE_LV12",
    "GROWLITHE_LV16",
    "GROWLITHE_LV18",
    "ARCANINE_LV34",
    "ARCANINE_LV35",
    "ARCANINE_LV45",
    "PONYTA_LV8",
    "PONYTA_LV10",
    "PONYTA_LV15",
    "RAPIDASH_LV30",
    "RAPIDASH_LV33",
    "DARK_RAPIDASH",
    "MAGMAR_LV18",
    "MAGMAR_LV24",
    "MAGMAR_LV27",
    "MAGMAR_LV31",
    "FLAREON_LV22",
    "FLAREON_LV28",
    "DARK_FLAREON",
    "MOLTRES_LV35",
    "MOLTRES_LV37",
    "MOLTRES_LV40",
    "SQUIRTLE_LV8",
    "SQUIRTLE_LV14",
    "SQUIRTLE_LV15",
    "SQUIRTLE_LV16",
    "WARTORTLE_LV22",
    "WARTORTLE_LV24",
    "DARK_WARTORTLE",
    "BLASTOISE_LV52",
    "BLASTOISE_ALT_LV52",
    "DARK_BLASTOISE",
    "PSYDUCK_LV15",
    "PSYDUCK_LV16",
    "GOLDUCK_LV27",
    "GOLDUCK_LV28",
    "DARK_GOLDUCK",
    "POLIWAG_LV13",
    "POLIWAG_LV15",
    "POLIWHIRL_LV28",
    "POLIWHIRL_LV30",
    "POLIWRATH_LV40",
    "POLIWRATH_LV48",
    "TENTACOOL",
    "TENTACRUEL",
    "SEEL_LV10",
    "SEEL_LV12",
    "DEWGONG_LV24",
    "DEWGONG_LV42",
    "SHELLDER_LV8",
    "SHELLDER_LV16",
    "CLOYSTER",
    "KRABBY_LV17",
    "KRABBY_LV20",
    "KINGLER_LV27",
    "KINGLER_LV33",
    "HORSEA_LV19",
    "HORSEA_LV20",
    "SEADRA_LV23",
    "SEADRA_LV26",
    "GOLDEEN",
    "SEAKING",
    "STARYU_LV15",
    "STARYU_LV17",
    "STARMIE",
    "DARK_STARMIE",
    "MAGIKARP_LV6",
    "MAGIKARP_LV8",
    "MAGIKARP_LV10",
    "GYARADOS",
    "DARK_GYARADOS",
    "LAPRAS_LV24",
    "LAPRAS_LV31",
    "VAPOREON_LV29",
    "VAPOREON_LV42",
    "DARK_VAPOREON",
    "OMANYTE_LV19",
    "OMANYTE_LV20",
    "OMANYTE_LV22",
    "OMASTAR_LV32",
    "OMASTAR_LV36",
    "ARTICUNO_LV34",
    "ARTICUNO_LV35",
    "ARTICUNO_LV37",
    "MARILL",
    "PIKACHU_LV5",
    "PIKACHU_LV12",
    "PIKACHU_LV13",
    "PIKACHU_LV14",
    "PIKACHU_LV16",
    "PIKACHU_ALT_LV16",
    "FLYING_PIKACHU_LV12",
    "FLYING_PIKACHU_ALT_LV12",
    "SURFING_PIKACHU_LV13",
    "SURFING_PIKACHU_ALT_LV13",
    "RAICHU_LV32",
    "RAICHU_LV33",
    "RAICHU_LV40",
    "RAICHU_LV45",
    "DARK_RAICHU",
    "MAGNEMITE_LV12",
    "MAGNEMITE_LV13",
    "MAGNEMITE_LV14",
    "MAGNEMITE_LV15",
    "MAGNETON_LV28",
    "MAGNETON_LV30",
    "MAGNETON_LV35",
    "DARK_MAGNETON",
    "VOLTORB_LV8",
    "VOLTORB_LV10",
    "VOLTORB_LV13",
    "ELECTRODE_LV35",
    "ELECTRODE_LV42",
    "DARK_ELECTRODE",
    "ELECTABUZZ_LV20",
    "ELECTABUZZ_LV30",
    "ELECTABUZZ_LV35",
    "JOLTEON_LV24",
    "JOLTEON_LV29",
    "DARK_JOLTEON",
    "ZAPDOS_LV28",
    "ZAPDOS_LV40",
    "ZAPDOS_LV64",
    "ZAPDOS_LV68",
    "SANDSHREW_LV12",
    "SANDSHREW_LV15",
    "SANDSLASH_LV33",
    "SANDSLASH_LV35",
    "DIGLETT_LV8",
    "DIGLETT_LV15",
    "DIGLETT_LV16",
    "DUGTRIO_LV36",
    "DUGTRIO_LV40",
    "DARK_DUGTRIO",
    "MANKEY_LV7",
    "MANKEY_ALT_LV7",
    "MANKEY_LV14",
    "PRIMEAPE",
    "DARK_PRIMEAPE",
    "MACHOP_LV18",
    "MACHOP_LV20",
    "MACHOP_LV24",
    "MACHOKE_LV24",
    "MACHOKE_LV28",
    "MACHOKE_LV40",
    "DARK_MACHOKE",
    "MACHAMP_LV54",
    "MACHAMP_LV67",
    "DARK_MACHAMP",
    "GEODUDE_LV15",
    "GEODUDE_LV16",
    "GRAVELER_LV27",
    "GRAVELER_LV28",
    "GRAVELER_LV29",
    "GOLEM_LV36",
    "GOLEM_LV37",
    "ONIX_LV12",
    "ONIX_LV25",
    "CUBONE_LV13",
    "CUBONE_LV14",
    "MAROWAK_LV26",
    "MAROWAK_LV32",
    "DARK_MAROWAK",
    "HITMONLEE_LV23",
    "HITMONLEE_LV30",
    "HITMONCHAN_LV23",
    "HITMONCHAN_LV33",
    "RHYHORN",
    "RHYDON_LV37",
    "RHYDON_LV48",
    "KABUTO_LV9",
    "KABUTO_LV22",
    "KABUTOPS",
    "AERODACTYL_LV28",
    "AERODACTYL_LV30",
    "ABRA_LV8",
    "ABRA_LV10",
    "ABRA_LV14",
    "KADABRA_LV38",
    "KADABRA_LV39",
    "DARK_KADABRA",
    "ALAKAZAM_LV42",
    "ALAKAZAM_LV45",
    "DARK_ALAKAZAM",
    "SLOWPOKE_LV9",
    "SLOWPOKE_LV16",
    "SLOWPOKE_LV18",
    "SLOWBRO_LV26",
    "SLOWBRO_LV35",
    "DARK_SLOWBRO",
    "GASTLY_LV8",
    "GASTLY_LV13",
    "GASTLY_LV17",
    "HAUNTER_LV17",
    "HAUNTER_LV22",
    "HAUNTER_LV25",
    "HAUNTER_LV26",
    "DARK_HAUNTER",
    "GENGAR_LV38",
    "GENGAR_LV40",
    "DARK_GENGAR",
    "DROWZEE_LV10",
    "DROWZEE_LV12",
    "HYPNO_LV30",
    "HYPNO_LV36",
    "DARK_HYPNO",
    "MR_MIME_LV20",
    "MR_MIME_LV28",
    "JYNX_LV18",
    "JYNX_LV23",
    "JYNX_LV27",
    "MEWTWO_LV30",
    "MEWTWO_LV53",
    "MEWTWO_LV54",
    "MEWTWO_LV60",
    "MEWTWO_ALT_LV60",
    "MEWTWO_LV67",
    "GRS_MEWTWO",
    "MEW_LV8",
    "MEW_LV15",
    "MEW_LV23",
    "PIDGEY_LV8",
    "PIDGEY_LV10",
    "PIDGEOTTO_LV36",
    "PIDGEOTTO_LV38",
    "PIDGEOT_LV38",
    "PIDGEOT_LV40",
    "RATTATA_LV9",
    "RATTATA_LV12",
    "RATTATA_LV15",
    "RATICATE",
    "DARK_RATICATE",
    "SPEAROW_LV9",
    "SPEAROW_LV12",
    "SPEAROW_LV13",
    "FEAROW_LV24",
    "FEAROW_LV27",
    "DARK_FEAROW",
    "CLEFAIRY_LV14",
    "CLEFAIRY_LV15",
    "CLEFABLE",
    "DARK_CLEFABLE",
    "JIGGLYPUFF_LV12",
    "JIGGLYPUFF_LV13",
    "JIGGLYPUFF_LV14",
    "WIGGLYTUFF_LV36",
    "WIGGLYTUFF_LV40",
    "MEOWTH_LV10",
    "MEOWTH_LV13",
    "MEOWTH_LV14",
    "MEOWTH_LV15",
    "MEOWTH_LV17",
    "PERSIAN",
    "DARK_PERSIAN_LV28",
    "DARK_PERSIAN_ALT_LV28",
    "FARFETCHD_LV20",
    "FARFETCHD_ALT_LV20",
    "DODUO_LV8",
    "DODUO_LV10",
    "DODRIO_LV25",
    "DODRIO_LV28",
    "LICKITUNG_LV20",
    "LICKITUNG_LV26",
    "CHANSEY_LV40",
    "CHANSEY_LV55",
    "KANGASKHAN_LV36",
    "KANGASKHAN_LV38",
    "KANGASKHAN_LV40",
    "TAUROS_LV32",
    "TAUROS_LV35",
    "DITTO",
    "EEVEE_LV5",
    "EEVEE_LV9",
    "EEVEE_LV12",
    "PORYGON_LV12",
    "PORYGON_LV18",
    "PORYGON_LV20",
    "COOL_PORYGON",
    "SNORLAX_LV20",
    "SNORLAX_LV35",
    "HUNGRY_SNORLAX",
    "DRATINI_LV10",
    "DRATINI_LV12",
    "DRAGONAIR",
    "DARK_DRAGONAIR",
    "DRAGONITE_LV41",
    "DRAGONITE_LV43",
    "DRAGONITE_LV45",
    "DARK_DRAGONITE",
    "TOGEPI",
    "LUGIA",
    "SUPER_POTION",
    "IMAKUNI_CARD",
    "ENERGY_REMOVAL",
    "ENERGY_RETRIEVAL",
    "ENERGY_SEARCH",
    "PROFESSOR_OAK",
    "FOSSIL_EXCAVATION",
    "POTION",
    "GAMBLER",
    "REVIVE",
    "MAX_REVIVE",
    "SUPER_SCOOP_UP",
    "DEVOLUTION_SPRAY",
    "ITEMFINDER",
    "CHALLENGE",
    "SUPER_ENERGY_RETRIEVAL",
    "SUPER_ENERGY_REMOVAL",
    "MOON_STONE",
    "DEFENDER",
    "GUST_OF_WIND",
    "MYSTERIOUS_FOSSIL",
    "FULL_HEAL",
    "IMPOSTER_OAKS_REVENGE",
    "IMPOSTER_PROFESSOR_OAK",
    "SLEEP",
    "COMPUTER_ERROR",
    "COMPUTER_SEARCH",
    "DIGGER",
    "CLEFAIRY_DOLL",
    "MR_FUJI",
    "PLUSPOWER",
    "SWITCH",
    "SCOOP_UP",
    "POKEMON_TRADER",
    "POKEMON_RECALL",
    "POKEDEX",
    "POKEMON_CENTER",
    "POKEMON_BREEDER",
    "POKEMON_FLUTE",
    "THE_BOSSS_WAY",
    "GOOP_GAS_ATTACK",
    "BILL",
    "BILLS_TELEPORTER",
    "BILLS_COMPUTER",
    "MASTER_BALL",
    "LASS",
    "MAINTENENCE",
    "POKEBALL",
    "NIGHTLY_GARBAGE_RUN",
    "RECYCLE",
    "ROCKETS_SNEAK_ATTACK",
    "HERE_COMES_TEAM_ROCKET",
    "THE_ROCKETS_TRAP",
];

// Card pop rarity
const CIRCLE = 0x0;
const DIAMOND = 0x1;
const STAR = 0x2;
const PHANTOM = 0xfe;
const ENERGY = 0xff;

// Card sets
const BEGINNING_POKEMON = 0;
const LEGENDARY_POWER = 1;
const ISLAND_OF_FOSSIL = 2;
const PSYCHIC_BATTLE = 3;
const SKY_FLYING_POKEMON = 4;
const WE_ARE_TEAM_ROCKET = 5;
const TEAM_ROCKETS_AMBITION = 6;
const PROMOTIONAL = 7;

// IR type
const IRPARAM_CARD_POP = 1;
const IRPARAM_SEND_CARDS = 2;
const IRPARAM_SEND_DECK = 3;
const IRPARAM_RARE_CARD_POP = 4;

const CIRCLE_CARD_LIST = createCardPopCandidateList(CIRCLE, BEGINNING_POKEMON, TEAM_ROCKETS_AMBITION);
const DIAMOND_CARD_LIST = createCardPopCandidateList(DIAMOND, BEGINNING_POKEMON, TEAM_ROCKETS_AMBITION);
const STAR_CARD_LIST = createCardPopCandidateList(STAR, BEGINNING_POKEMON, TEAM_ROCKETS_AMBITION);
const PHANTOM_CARD_LIST = createCardPopCandidateList(PHANTOM, BEGINNING_POKEMON, TEAM_ROCKETS_AMBITION);
const ENERGY_CARD_LIST = createCardPopCandidateList(ENERGY, BEGINNING_POKEMON, TEAM_ROCKETS_AMBITION);

const cardPopCandidateLists = new Map([
    [CIRCLE, CIRCLE_CARD_LIST],
    [DIAMOND, DIAMOND_CARD_LIST],
    [STAR, STAR_CARD_LIST],
    [PHANTOM, PHANTOM_CARD_LIST],
    [ENERGY, ENERGY_CARD_LIST],
]);

function hashName(nameBuffer) {
    let d = 0x0;
    let e = 0x0;
    for (let byte of nameBuffer) {
        e += byte;
        e &= 0xff;
        d ^= byte;
    }
    return [d, e];
}

function setRng(b, c, d, e) {
    let wRNG1 = (b - d) & 0xff;
    let wRNG2 = (c - e) & 0xff;
    let wRNGCounter = (wRNG2 + wRNG1) & 0xff;
    return [wRNG1, wRNG2, wRNGCounter];
}

function rotateLeft(n, d) {
    return ((n << d) | (n >>> (8 - d))) & 0xff;
}

function rotateLeftThroughCarry(n, carry) {
    n = (n << 1) | carry;
    carry = (n >>> 8) & 1;
    n &= 0xff;
    return [n, carry];
}

function updateRngSources(wRNG1, wRNG2, wRNGCounter) {
    let d = wRNG2;
    let e = wRNG1;
    let a = d;

    a = rotateLeft(a, 2);
    a ^= e;

    let carry = a & 1;
    a = (a >>> 1) & 0xff;

    d ^= e;
    let tmp = wRNGCounter;
    tmp ^= e;
    e = tmp;

    [e, carry] = rotateLeftThroughCarry(e, carry);
    [d, carry] = rotateLeftThroughCarry(d, carry);
    a = d;
    a ^= e;

    wRNGCounter += 1;
    wRNGCounter &= 0xff;
    wRNG2 = d;
    wRNG1 = e;
    return a;
}

function random(h, wRNG1, wRNG2, wRNGCounter) {
    let l = updateRngSources(wRNG1, wRNG2, wRNGCounter);
    let hl = (h * l) & 0xffff;
    h = (hl >>> 8) & 0xff;
    return h;
}

function getRarity(e, wCardPopType) {
    return e === 5 ? PHANTOM
         : wCardPopType === IRPARAM_RARE_CARD_POP || e < 64 ? STAR
         : e < 154 ? DIAMOND
         : CIRCLE;
}

function createCardPopCandidateList(a, b, c) {
    if (a === 0xff) {
        // Only energy cards
        return [
            "GRASS_ENERGY", "FIRE_ENERGY", "WATER_ENERGY", "LIGHTNING_ENERGY", "FIGHTING_ENERGY", "PSYCHIC_ENERGY",
            "GRASS_ENERGY", "FIRE_ENERGY", "WATER_ENERGY", "LIGHTNING_ENERGY", "FIGHTING_ENERGY", "PSYCHIC_ENERGY"
        ];
    }

    if (a === 0xfe) {
        // Only Phantom cards
        return [
            "VENUSAUR_LV64", "MEW_LV15", "HERE_COMES_TEAM_ROCKET", "LUGIA",
            "VENUSAUR_LV64", "MEW_LV15", "HERE_COMES_TEAM_ROCKET", "LUGIA"
        ];
    }

    // Otherwise, filter cards by rarity and set
    let wCardPopCandidateList = [];
    for (const card of cardData) {
        if (card.rarity === a && b <= card.set && card.set <= c) {
            wCardPopCandidateList.push(cardNames[card.id]);
        }
    }
    return wCardPopCandidateList;
}

function calculateCardPop(p1NameBuffer, p2NameBuffer, wCardPopType) {
    const [b, c] = hashName(p1NameBuffer);
    const [d, e] = hashName(p2NameBuffer);

    let [wRNG1, wRNG2, wRNGCounter] = setRng(b, c, d, e);

    const rarity = getRarity(wRNG2, wCardPopType);

    const  wCardPopCandidateList = cardPopCandidateLists.get(rarity);

    const hl = random(wCardPopCandidateList.length, wRNG1, wRNG2, wRNGCounter);
    return wCardPopCandidateList[hl];
}

function bytesToString(bytes) {
    const latin = new Map([
        [0x10, "A"],
        [0x11, "B"],
        [0x12, "C"],
        [0x13, "D"],
        [0x14, "E"],
        [0x15, "F"],
        [0x16, "G"],
        [0x17, "H"],
        [0x18, "I"],
        [0x19, "J"],
        [0x1a, "K"],
        [0x1b, "L"],
        [0x1c, "M"],
        [0x1d, "N"],
        [0x1e, "O"],
        [0x1f, "P"],
        [0x20, "Q"],
        [0x21, "R"],
        [0x22, "S"],
        [0x23, "T"],
        [0x24, "U"],
        [0x25, "V"],
        [0x26, "W"],
        [0x27, "X"],
        [0x28, "Y"],
        [0x29, "Z"],
        [0x2a, "a"],
        [0x2b, "b"],
        [0x2c, "c"],
        [0x2d, "d"],
        [0x2e, "e"],
        [0x2f, "f"],
        [0x30, "g"],
        [0x31, "h"],
        [0x32, "i"],
        [0x33, "j"],
        [0x34, "k"],
        [0x35, "l"],
        [0x36, "m"],
        [0x37, "n"],
        [0x38, "o"],
        [0x39, "p"],
        [0x3a, "q"],
        [0x3b, "r"],
        [0x3c, "s"],
        [0x3d, "t"],
        [0x3e, "u"],
        [0x3f, "v"],
        [0x40, "w"],
        [0x41, "x"],
        [0x42, "y"],
        [0x43, "z"],
        [0x46, "о"],
        [0x4d, "@"],
        [0x4e, ":"],
        [0x4f, ";"],
        [0x57, "_"],
        [0x5d, "ˍ"],
        [0x5e, "&"],
        [0x5f, "*"],
        [0x60, "<"],
        [0x61, ">"],
        [0x62, "="],
    ]);

    const symbols = new Map([
        [0x01, "FIRE"],
        [0x02, "GRASS"],
        [0x03, "LIGHTNING"],
        [0x04, "WATER"],
        [0x05, "FIGHTING"],
        [0x06, "PSYCHIC"],
        [0x07, "COLORLESS"],
        [0x08, "RAINBOW"],
        [0x11, "Lv"],
        [0x13, "No"],
    ]);

    const hiragana = new Map([
        [0x10, "を"],
        [0x11, "あ"],
        [0x12, "い"],
        [0x13, "う"],
        [0x14, "え"],
        [0x15, "お"],
        [0x16, "か"],
        [0x17, "き"],
        [0x18, "く"],
        [0x19, "け"],
        [0x1a, "こ"],
        [0x1b, "さ"],
        [0x1c, "し"],
        [0x1d, "す"],
        [0x1e, "せ"],
        [0x1f, "そ"],
        [0x20, "た"],
        [0x21, "ち"],
        [0x22, "つ"],
        [0x23, "て"],
        [0x24, "と"],
        [0x25, "な"],
        [0x26, "に"],
        [0x27, "ぬ"],
        [0x28, "ね"],
        [0x29, "の"],
        [0x2a, "は"],
        [0x2b, "ひ"],
        [0x2c, "ふ"],
        [0x2d, "へ"],
        [0x2e, "ほ"],
        [0x2f, "ま"],
        [0x30, "み"],
        [0x31, "む"],
        [0x32, "め"],
        [0x33, "も"],
        [0x34, "や"],
        [0x35, "ゆ"],
        [0x36, "よ"],
        [0x37, "ら"],
        [0x38, "り"],
        [0x39, "る"],
        [0x3a, "れ"],
        [0x3b, "ろ"],
        [0x3c, "わ"],
        [0x3d, "ん"],
        [0x3e, "が"],
        [0x3f, "ぎ"],
        [0x40, "ぐ"],
        [0x41, "げ"],
        [0x42, "ご"],
        [0x43, "ざ"],
        [0x44, "じ"],
        [0x45, "ず"],
        [0x46, "ぜ"],
        [0x47, "ぞ"],
        [0x48, "だ"],
        [0x49, "ぢ"],
        [0x4a, "づ"],
        [0x4b, "で"],
        [0x4c, "ど"],
        [0x4d, "ば"],
        [0x4e, "び"],
        [0x4f, "ぶ"],
        [0x50, "べ"],
        [0x51, "ぼ"],
        [0x52, "ぱ"],
        [0x53, "ぴ"],
        [0x54, "ぷ"],
        [0x55, "ぺ"],
        [0x56, "ぽ"],
        [0x57, "ぁ"],
        [0x58, "ぃ"],
        [0x59, "ぅ"],
        [0x5a, "ぇ"],
        [0x5b, "ぉ"],
        [0x5c, "ゃ"],
        [0x5d, "ゅ"],
        [0x5e, "ょ"],
        [0x5f, "っ"],
        [0x60, "0"],
        [0x61, "1"],
        [0x62, "2"],
        [0x63, "3"],
        [0x64, "4"],
        [0x65, "5"],
        [0x66, "6"],
        [0x67, "7"],
        [0x68, "8"],
        [0x69, "9"],
        [0x6a, "+"],
        [0x6b, "-"],
        [0x6d, "/"],
        [0x6e, "!"],
        [0x6f, "?"],
        [0x70, " "],
        [0x77, "・"],
        [0x78, "ー"],
    ]);

    const katakana = new Map([
        [0x10, "ヲ"],
        [0x11, "ア"],
        [0x12, "イ"],
        [0x13, "ウ"],
        [0x14, "エ"],
        [0x15, "オ"],
        [0x16, "カ"],
        [0x17, "キ"],
        [0x18, "ク"],
        [0x19, "ケ"],
        [0x1a, "コ"],
        [0x1b, "サ"],
        [0x1c, "シ"],
        [0x1d, "ス"],
        [0x1e, "セ"],
        [0x1f, "ソ"],
        [0x20, "タ"],
        [0x21, "チ"],
        [0x22, "ツ"],
        [0x23, "テ"],
        [0x24, "ト"],
        [0x25, "ナ"],
        [0x26, "ニ"],
        [0x27, "ヌ"],
        [0x28, "ネ"],
        [0x29, "ノ"],
        [0x2a, "ハ"],
        [0x2b, "ヒ"],
        [0x2c, "フ"],
        [0x2d, "ヘ"],
        [0x2e, "ホ"],
        [0x2f, "マ"],
        [0x30, "ミ"],
        [0x31, "ム"],
        [0x32, "メ"],
        [0x33, "モ"],
        [0x34, "ヤ"],
        [0x35, "ユ"],
        [0x36, "ヨ"],
        [0x37, "ラ"],
        [0x38, "リ"],
        [0x39, "ル"],
        [0x3a, "レ"],
        [0x3b, "ロ"],
        [0x3c, "ワ"],
        [0x3d, "ン"],
        [0x3e, "ガ"],
        [0x3f, "ギ"],
        [0x40, "グ"],
        [0x41, "ゲ"],
        [0x42, "ゴ"],
        [0x43, "ザ"],
        [0x44, "ジ"],
        [0x45, "ズ"],
        [0x46, "ゼ"],
        [0x47, "ゾ"],
        [0x48, "ダ"],
        [0x49, "ヂ"],
        [0x4a, "ヅ"],
        [0x4b, "デ"],
        [0x4c, "ド"],
        [0x4d, "バ"],
        [0x4e, "ビ"],
        [0x4f, "ブ"],
        [0x50, "ベ"],
        [0x51, "ボ"],
        [0x52, "パ"],
        [0x53, "ピ"],
        [0x54, "プ"],
        [0x55, "ペ"],
        [0x56, "ポ"],
        [0x57, "ァ"],
        [0x58, "ィ"],
        [0x59, "ゥ"],
        [0x5a, "ェ"],
        [0x5b, "ォ"],
        [0x5c, "ャ"],
        [0x5d, "ュ"],
        [0x5e, "ョ"],
        [0x5f, "ッ"],
        [0x70, " "],
        [0x78, "ー"],
    ]);

    const charmaps = new Map([
        [0x04, latin],
        [0x05, symbols],
        [0x0e, hiragana],
        [0x0f, katakana],
    ]);

    let name = "";
    let charmap;
    let odd = true;
    for (const byte of bytes) {
        if (byte === 0x00)
            break;
        if (odd)
            charmap = charmaps.get(byte);
        else
            name += charmap.get(byte);
        odd = !odd;
    }
    return name;
}
